import{I as D,z as E,r as x,K as z,J as V,A as S,a as I,w as R,f as d,g as m,i as e,k as $,B as g,D as k,F as B,M as T,u as f,N,l as J,n as U,E as u,j as P}from"./index-e978c30f.js";import{_ as K}from"./SideBar-f0adbc64.js";import{_ as O}from"./TheModal-6bc90acc.js";import{c as w}from"./catchError-23a142f6.js";import{s as j,a as G,e as H,d as Q}from"./user-e3118356.js";import{u as W,e as X}from"./formValidate-a0d0f42c.js";import"./LOGO_horizon-e3e3e605.js";import"./titleNo-3c0f6505.js";import"./axios-15129f52.js";const Y=D("memberData",()=>{const _=E(),i=x([]),l=x(null),h=w(async(r,c)=>{var a;_.isLoading=!0;const{data:t}=await j(r,c);l.value=(a=t.meta)==null?void 0:a.pagination.nextPage,i.value=t.membersList,i.value.forEach(b=>{y.value.push(b)}),_.isLoading=!1}),y=x([]),p=w(async(r,c)=>{var a;_.isLoading=!0;const{data:t}=await j(r,c);l.value=(a=t.meta)==null?void 0:a.pagination.nextPage,t.membersList.length===0&&(z("沒有符合的會員資料"),_.isLoading=!1),y.value=t.membersList,_.isLoading=!1}),M=w(async(r,c)=>{const{phone:t}=c,{message:a}=await G(r);V(a),p(t,1)}),s=w(async(r,c,t)=>{const{phone:a}=t,{message:b}=await H(r,c);V(b),p(a,1)}),L=w(async(r,c)=>{const{phone:t}=c,{message:a}=await Q(r);V(a),p(t,1)});return{memberList:y,getMembers:p,prePage:l,postMember:M,patchMember:s,delMember:L,LoadNewFile:h}}),Z={class:"fixed top-0 left-0 z-40 w-[315px] h-screen"},ee={class:"ml-[315px] bg-white"},te=e("nav",{class:"border-b-2 border-textself p-6"},[e("h1",{class:"flex items-center text-[36px] font-bold"},"會員資訊")],-1),se={class:"min-h-screen p-6"},oe={class:"flex justify-between items-end mb-6"},ne={class:"flex flex-col"},ae=e("label",{for:"searchPhone",class:"block mb-2 font-medium"},"電話",-1),le={class:"overflow-auto bg-bgself-light rounded-xl p-5"},ie={class:"w-full text-center"},re=e("thead",{class:"text-xl font-medium text-secondary-light bg-textself"},[e("tr",{class:"border-b-2 border-black"},[e("th",{class:"py-3"},"姓名"),e("th",{class:"py-3"},"電話"),e("th",{class:"py-3"},"註冊日期"),e("th",{class:"py-3"})])],-1),ce={class:"py-3"},de={class:"py-3"},me={class:"py-3"},pe={class:"flex justify-end items-center"},ue=["onClick"],he=["onClick"],be=e("span",{class:"text-xl lg:text-[28px] font-medium"},"點選以載入新資料",-1),_e=[be],fe={class:"relative w-full h-full max-w-md md:h-auto"},xe={class:"relative bg-white border-2 border-textself rounded-lg shadow"},ye={class:"flex items-center justify-end border-b-2 border-textself p-3 rounded-t"},ve={key:0,class:"text-xl font-medium"},ge={key:1,class:"text-xl font-medium"},ke={key:2,class:"text-xl font-medium"},we=e("svg",{"aria-hidden":"true",class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),Me=e("span",{class:"sr-only text-black"},"Close modal",-1),Ce=[we,Me],Le={class:"w-full rounded-lg"},Fe={key:0,class:"space-y-3 p-3"},Ve=e("label",{for:"name",class:"block mb-2 text-xl font-medium text-gray-900"},"姓名",-1),Ne={class:"text-sm text-primary-light mt-2"},Pe=e("label",{for:"phone",class:"block mb-2 text-xl font-medium text-gray-900"},"電話",-1),Se={class:"text-sm text-primary-light mt-2"},$e=["onClick"],Be={key:1,class:"space-y-3 p-3"},Ue=e("label",{for:"name",class:"block mb-2 text-xl font-medium text-gray-900"},"姓名",-1),je={class:"text-sm text-primary-light mt-2"},qe=e("label",{for:"phone",class:"block mb-2 text-xl font-medium text-gray-900"},"電話",-1),Ae={class:"text-sm text-primary-light mt-2"},De=["onClick"],Ee={key:2,class:"space-y-3 p-3"},ze=e("p",{class:"block mb-2 text-xl font-medium text-gray-900"},"姓名",-1),Ie=e("p",{class:"block mb-2 text-xl font-medium text-gray-900"},"電話",-1),Re=e("p",{class:"text-xl font-medium text-neutral-400"},"是否要刪除會員資料?",-1),Te=["onClick"],Ze={__name:"MemberView",setup(_){const i=Y(),l=S({phone:""}),h=x(1),y=()=>{h.value++,i.LoadNewFile(l.phone,h.value)};I(()=>{i.getMembers(l.phone,1),h.value=1}),R(()=>l.phone,()=>{i.getMembers(l.phone,1),h.value=1},{immediate:!0,deep:!0});const{errors:p,useFieldModel:M}=W({validationSchema:X}),s=S({_id:"",name:M("name"),phone:M("phone")}),L=()=>{i.postMember(s,l),C()},r=()=>{i.patchMember(s._id,s,l),C()},c=()=>{i.delMember(s._id,l),C()},t=x(!1),a=x(),b=(v,n)=>{t.value=v;const o=a.value;U(()=>{if(o&&o.openModal(),t.value==="update"||t.value==="delete"){const{_id:F,name:q,phone:A}=n;s._id=F,s.name=q,s.phone=A,h.value=1}})},C=()=>{const v=a.value;U(()=>{v&&(v.closeModal(),l.phone="",s.name="",s.phone="")})};return(v,n)=>(d(),m(B,null,[e("aside",Z,[$(K)]),e("section",ee,[te,e("main",se,[e("div",oe,[e("div",ne,[ae,g(e("input",{type:"tel",id:"searchPhone",class:"block form-input p-3",placeholder:"0912345678","onUpdate:modelValue":n[0]||(n[0]=o=>l.phone=o)},null,512),[[k,l.phone]])]),e("button",{onClick:n[1]||(n[1]=o=>b("create")),class:"btn btn-dark whitespace-nowrap"}," 新增會員 ")]),e("section",le,[e("table",ie,[re,e("tbody",null,[(d(!0),m(B,null,T(f(i).memberList,o=>(d(),m("tr",{class:"border-b-2 border-black",key:o.number},[e("td",ce,u(o.name),1),e("td",de,u(o.phone),1),e("td",me,u(o.createdAt),1),e("th",pe,[e("button",{onClick:F=>b("update",o),class:"btn btn-outline-dark w-auto mx-1 my-2"}," 修改 ",8,ue),e("button",{onClick:F=>b("delete",o),class:"btn btn-outline-dark w-auto mx-1 my-2"}," 刪除 ",8,he)])]))),128))])])]),f(i).prePage!==null?(d(),m("button",{key:0,type:"button",class:"w-full btn btn-secondary my-6",onClick:y},_e)):N("",!0)])]),$(O,{ref_key:"childComponentRef",ref:a},{default:J(()=>[e("section",fe,[e("div",xe,[e("div",ye,[t.value==="create"?(d(),m("h2",ve,"新增會員資料")):t.value==="update"?(d(),m("h2",ge,"修改會員資料")):t.value==="delete"?(d(),m("h2",ke,"刪除會員資料")):N("",!0),e("button",{onClick:n[2]||(n[2]=o=>C()),type:"button",class:"text-gray-400 bg-black hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center"},Ce)]),e("div",Le,[t.value==="create"?(d(),m("form",Fe,[e("div",null,[Ve,g(e("input",{type:"text",name:"name",id:"name",key:"name",class:"form-input",placeholder:"name","onUpdate:modelValue":n[3]||(n[3]=o=>s.name=o),required:""},null,512),[[k,s.name,void 0,{trim:!0}]]),e("p",Ne,u(f(p).name),1)]),e("div",null,[Pe,g(e("input",{type:"tel",name:"phone",id:"phone",key:"phone",class:"form-input",placeholder:"0912345678","onUpdate:modelValue":n[4]||(n[4]=o=>s.phone=o),required:""},null,512),[[k,s.phone]]),e("p",Se,u(f(p).phone),1)]),e("button",{type:"submit",class:"w-full btn btn-dark",onClick:P(L,["prevent"])}," 確認新增 ",8,$e)])):t.value==="update"?(d(),m("form",Be,[e("div",null,[Ue,g(e("input",{type:"text",name:"name",id:"name",key:"name",class:"form-input",placeholder:"name","onUpdate:modelValue":n[5]||(n[5]=o=>s.name=o),required:""},null,512),[[k,s.name,void 0,{trim:!0}]]),e("p",je,u(f(p).name),1)]),e("div",null,[qe,g(e("input",{type:"tel",name:"phone",id:"phone",key:"phone",class:"form-input",placeholder:"0912345678","onUpdate:modelValue":n[6]||(n[6]=o=>s.phone=o),required:""},null,512),[[k,s.phone]]),e("p",Ae,u(f(p).phone),1)]),e("button",{type:"submit",class:"w-full btn btn-dark",onClick:P(r,["prevent"])}," 確認修改 ",8,De)])):t.value==="delete"?(d(),m("form",Ee,[e("div",null,[ze,e("p",null,u(s.name),1)]),e("div",null,[Ie,e("p",null,u(s.phone),1)]),Re,e("button",{type:"submit",class:"w-full btn btn-dark",onClick:P(c,["prevent"])}," 確認刪除 ",8,Te)])):N("",!0)])])])]),_:1},512)],64))}};export{Ze as default};
