import{I as H,z as Q,r as L,J as j,K as X,y as Y,A as F,a as Z,w as ee,f as n,g as l,i as e,k as J,B as v,L as N,F as f,M as g,u as M,l as te,E as i,t as C,m as S,N as K,D as A,j as W,n as P}from"./index-e978c30f.js";import{_ as se}from"./SideBar-f0adbc64.js";import{_ as oe}from"./TheModal-6bc90acc.js";import{c as I}from"./catchError-23a142f6.js";import{n as ae,s as ne,a as le,e as ie,d as re}from"./seat-9b4bb4be.js";import{u as de,e as ce}from"./formValidate-a0d0f42c.js";import{d as me}from"./day-cea40187.js";import"./LOGO_horizon-e3e3e605.js";import"./titleNo-3c0f6505.js";import"./axios-15129f52.js";const ue=H("seatData",()=>{const R=Q(),q=I(async m=>{R.isLoading=!0;const{reservationDate:d,reservationTime:u,tableNo:b}=m,{message:s}=await ae({reservationDate:d,reservationTime:u,tableNo:b});s==="成功"&&j("修改入座成功"),c(m),R.isLoading=!1}),_=L([]),c=I(async m=>{R.isLoading=!0;const{status:d,reservationDate:u,reservationTime:b}=m,{data:s}=await ne(d,u,b);s.tables.length===0&&(X("沒有符合的座位資料"),R.isLoading=!1),_.value=s.tables.sort(function(D,T){return D.tableName-T.tableName}),R.isLoading=!1}),x=I(async(m,d)=>{const{tableNo:u,reservationDate:b,reservationTime:s,name:D,phone:T}=m,{message:V}=await le({tableNo:u,reservationDate:b,reservationTime:s,name:D,phone:T});V==="成功"&&j("新增成功"),c(d)}),y=I(async(m,d)=>{const{status:u,reservationId:b,reservationDate:s,reservationTime:D,name:T,phone:V}=m,{message:B}=await ie(b,{status:u,reservationDate:s,reservationTime:D,name:T,phone:V});B==="成功"&&j("修改成功"),c(d)}),r=I(async(m,d)=>{const{reservationId:u}=m,{message:b}=await re(u);j(b),c(d)});return{seatList:_,haveASeat:q,searchSeats:c,postReservation:x,patchReservation:y,delReservation:r}}),pe={class:"fixed top-0 left-0 z-40 w-[315px] h-screen"},ve={class:"ml-[315px] bg-white"},_e=e("nav",{class:"border-b-2 border-textself p-6"},[e("h1",{class:"flex items-center text-[36px] font-bold"},"座位資訊")],-1),be={class:"min-h-screen p-6"},he={class:"grid grid-cols-12 gap-4 items-center mb-6"},fe={class:"col-span-3"},xe=e("label",{for:"seat_status",class:"block mb-2 font-medium"},"狀態",-1),ye=["value"],ge={class:"col-span-3"},ke=e("label",{for:"seat_reservationDate",class:"block mb-2 font-medium"},"日期",-1),we=["value"],Ne={class:"col-span-3"},De=e("label",{for:"seat_reservationTime",class:"block mb-2 font-medium"},"訂位時段",-1),Te=["value"],Ce={class:"grid grid-cols-12 gap-4"},Se={class:"flex justify-between items-center border-b-2 border-textself px-4"},Re={class:"font-medium mb-5"},Le={class:"text-white bg-primary-light rounded py-1 px-2"},Ve={class:"font-medium mb-5"},Ue={class:"text-white bg-textself rounded py-1 px-2"},Me={class:"pl-4 pr-3 mt-4"},Ie={class:"font-medium"},$e={class:"ml-2"},je={class:"flex flex-wrap justify-between items-center mt-4"},Fe={class:"mb-2"},Ae={class:"flex justify-between items-center"},qe=["onClick"],Be=["onClick"],ze=["onClick"],Ee=["onClick"],We=["onClick"],Oe={class:"relative w-full h-full max-w-md md:h-auto"},Je={class:"relative bg-white border-2 border-textself rounded-lg shadow"},Ke={class:"flex items-center justify-end border-b-2 border-textself p-3 rounded-t"},Pe={key:0,class:"text-xl font-medium"},Ge={key:1,class:"text-xl font-medium"},He=e("svg",{"aria-hidden":"true",class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),Qe=e("span",{class:"sr-only text-black"},"Close modal",-1),Xe=[He,Qe],Ye={key:0,class:"w-full rounded-lg p-3"},Ze={class:"flex justify-between items-center bg-bgself-light rounded-xl p-3 mb-3"},et={class:"font-medium"},tt={class:"text-white bg-primary-light rounded py-1 px-2"},st={class:"font-medium"},ot={class:"text-white bg-textself rounded py-1 px-2"},at={class:"space-y-3",action:"#"},nt=e("label",{for:"form_reservationDate",class:"block mb-2 font-medium"},"日期",-1),lt=["value"],it=e("label",{for:"form_reservationTime",class:"block mb-2 font-medium"},"訂位時段",-1),rt=["value"],dt=e("label",{for:"form_name",class:"block mb-2 font-medium"},"姓名",-1),ct={class:"text-sm text-primary-light mt-2"},mt=e("label",{for:"form_tel",class:"block mb-2 font-medium"},"電話",-1),ut={class:"text-sm text-primary-light mt-2"},pt=["onClick"],vt={key:1,class:"w-full rounded-lg p-3"},_t={class:"flex justify-between items-center bg-bgself-light rounded-xl p-3 mb-3"},bt={class:"font-medium"},ht={class:"text-white bg-primary-light rounded py-1 px-2"},ft={class:"font-medium"},xt={class:"text-white bg-textself rounded py-1 px-2"},yt={class:"space-y-3",action:"#"},gt=e("label",{for:"form_reservationDate",class:"block mb-2 font-medium"},"日期",-1),kt=["value"],wt=e("label",{for:"form_reservationTime",class:"block mb-2 font-medium"},"訂位時段",-1),Nt=["value"],Dt=e("label",{for:"form_name",class:"block mb-2 font-medium"},"姓名",-1),Tt={class:"text-sm text-primary-light mt-2"},Ct=e("label",{for:"form_tel",class:"block mb-2 font-medium"},"電話",-1),St={class:"text-sm text-primary-light mt-2"},Rt=e("label",{for:"form_status",class:"block mb-2 font-medium"},"狀態",-1),Lt=["value"],Vt={class:"flex"},Ut=["onClick"],Wt={__name:"SeatView",setup(R){const q=Y(),_=ue(),c=L(["","未使用","使用中","已預約"]),x=L(me()),y=L(["上午","下午"]),r=F({status:c.value[0],reservationDate:x.value[0],reservationTime:y.value[0],tableNo:0});Z(()=>{_.searchSeats(r)}),ee([()=>r.status,()=>r.reservationDate,()=>r.reservationTime],()=>{_.searchSeats(r)},{immediate:!0,deep:!0});const m=h=>{r.tableNo=h,_.haveASeat(r)},{errors:d,useFieldModel:u}=de({validationSchema:ce}),b=F({tableNo:1,tableName:"",seats:1,status:c.value[3],reservationId:"",reservationDate:x.value[0],reservationTime:y.value[0],name:"",phone:""}),s=F({tableNo:1,tableName:"",seats:1,status:c.value[3],reservationId:"",reservationDate:x.value[0],reservationTime:y.value[0],name:u("name"),phone:u("phone")}),D=()=>{_.postReservation(s,r),$()},T=()=>{_.patchReservation(s,r),$()},V=()=>{_.delReservation(s,r),$()},B=h=>{const{tableNo:o,tableName:t,seats:a,status:w,reservation:p}=h;s.tableNo=o,s.tableName=t,s.seats=a,s.status=w,s.reservationDate=p.reservationDate,s.reservationId=p.reservationId,s.reservationTime=p.reservationTime,s.name="",s.phone="";const E=F({status:c.value[0],reservationDate:x.value[0],reservationTime:y.value[0],tableNo:0});_.delReservation(s,E)},G=h=>{q.push({path:"/product",query:{table:`${h}`}})},k=L(!1),z=L(),O=(h,o)=>{k.value=h;const t=z.value;P(()=>{if(t&&t.openModal(),k.value==="create"){const{tableNo:a,tableName:w,seats:p}=o;s.tableNo=a,s.tableName=w,s.seats=p}if(k.value==="update"||k.value==="delete"){const{tableNo:a,tableName:w,seats:p,status:E,reservation:U}=o;s.tableNo=a,s.tableName=w,s.seats=p,s.status=E,s.reservationDate=U.reservationDate,s.reservationId=U.reservationId,s.reservationTime=U.reservationTime,s.name=U.name,s.phone=U.phone}})},$=()=>{const h=z.value;P(()=>{h&&(h.closeModal(),Object.assign(s,b))})};return(h,o)=>(n(),l(f,null,[e("aside",pe,[J(se)]),e("section",ve,[_e,e("main",be,[e("ul",he,[e("li",fe,[xe,v(e("select",{id:"seat_status",class:"form-select py-3","onUpdate:modelValue":o[0]||(o[0]=t=>r.status=t)},[(n(!0),l(f,null,g(c.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t===""?"全部":t),9,ye))),128))],512),[[N,r.status]])]),e("li",ge,[ke,v(e("select",{id:"seat_reservationDate",class:"form-select py-3","onUpdate:modelValue":o[1]||(o[1]=t=>r.reservationDate=t)},[(n(!0),l(f,null,g(x.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,we))),128))],512),[[N,r.reservationDate]])]),e("li",Ne,[De,v(e("select",{id:"seat_reservationTime",class:"form-select py-3","onUpdate:modelValue":o[2]||(o[2]=t=>r.reservationTime=t)},[(n(!0),l(f,null,g(y.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,Te))),128))],512),[[N,r.reservationTime]])])]),e("ul",Ce,[(n(!0),l(f,null,g(M(_).seatList,t=>{var a,w;return n(),l("li",{class:"col-span-12 lg:col-span-6 xl:col-span-4 py-4 bg-white border-2 border-textself rounded-lg shadow",key:t._id},[e("div",Se,[e("p",Re,[C(" 桌號 "),e("span",Le,i(t.tableName),1)]),e("p",Ve,[C(" 人數 "),e("span",Ue,i(t.seats),1)])]),e("div",Me,[e("p",Ie,[C(i((a=t==null?void 0:t.reservation)!=null&&a.name?t.reservation.name:" ")+" ",1),e("span",$e,i((w=t==null?void 0:t.reservation)!=null&&w.phone?t.reservation.phone:" "),1)]),e("div",je,[e("p",Fe,[e("span",{class:S(["rounded py-1 px-2 mr-2",t.status==="未使用"?"bg-neutralself-100 text-white":"bg-secondary-light text-textself"])},i(t.status),3),e("span",{class:S(["rounded py-1 px-2",t.isWindowSeat?"bg-primary text-white":"hidden"])},i(t.isWindowSeat?"靠窗":""),3)]),e("div",Ae,[e("button",{onClick:p=>m(t.tableNo),type:"button",class:S(["btn btn-outline-dark mx-1",t.status==="未使用"?"":"hidden"])}," 入座 ",10,qe),e("button",{onClick:p=>O("create",t),type:"button",class:S(["btn btn-outline-dark mx-1",t.status==="未使用"?"":"hidden"])}," 預約 ",10,Be),e("button",{onClick:p=>O("update",t),type:"button",class:S(["btn btn-outline-dark mx-1",t.status==="已預約"?"":"hidden"])}," 修改 ",10,ze),e("button",{onClick:p=>G(t.tableName),type:"button",class:S(["btn btn-outline-dark mx-1",t.status==="使用中"?"":"hidden"])}," 點餐 ",10,Ee),e("button",{onClick:p=>B(t),type:"button",class:S(["btn btn-outline-dark mx-1",t.status==="使用中"?"":"hidden"])}," 清空 ",10,We)])])])])}),128))])])]),J(oe,{ref_key:"childComponentRef",ref:z},{default:te(()=>[e("section",Oe,[e("div",Je,[e("div",Ke,[k.value==="create"?(n(),l("h2",Pe,"新增訂位")):k.value==="update"?(n(),l("h2",Ge,"修改訂位 / 座位")):K("",!0),e("button",{onClick:o[3]||(o[3]=t=>$()),type:"button",class:"text-gray-400 bg-black hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center"},Xe)]),k.value==="create"?(n(),l("div",Ye,[e("div",Ze,[e("p",et,[C(" 桌號 "),e("span",tt,i(s.tableName),1)]),e("p",st,[C(" 人數 "),e("span",ot,i(s.seats),1)])]),e("form",at,[e("div",null,[nt,v(e("select",{id:"form_reservationDate",class:"form-select py-3","onUpdate:modelValue":o[4]||(o[4]=t=>s.reservationDate=t)},[(n(!0),l(f,null,g(x.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,lt))),128))],512),[[N,s.reservationDate]])]),e("div",null,[it,v(e("select",{id:"form_reservationTime",class:"form-select py-3","onUpdate:modelValue":o[5]||(o[5]=t=>s.reservationTime=t)},[(n(!0),l(f,null,g(y.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,rt))),128))],512),[[N,s.reservationTime]])]),e("div",null,[dt,v(e("input",{type:"text",name:"name",id:"form_name",class:"form-input",placeholder:"name","onUpdate:modelValue":o[6]||(o[6]=t=>s.name=t),required:""},null,512),[[A,s.name,void 0,{trim:!0}]]),e("p",ct,i(M(d).name),1)]),e("div",null,[mt,v(e("input",{type:"tel",name:"phone",id:"form_tel",class:"form-input",placeholder:"0912345678","onUpdate:modelValue":o[7]||(o[7]=t=>s.phone=t),required:""},null,512),[[A,s.phone]]),e("p",ut,i(M(d).phone),1)]),e("button",{type:"submit",class:"w-full btn btn-dark",onClick:W(D,["prevent"])}," 確定新增 ",8,pt)])])):k.value==="update"?(n(),l("div",vt,[e("div",_t,[e("p",bt,[C(" 桌號 "),e("span",ht,i(s.tableName),1)]),e("p",ft,[C(" 人數 "),e("span",xt,i(s.seats),1)])]),e("form",yt,[e("div",null,[gt,v(e("select",{id:"form_reservationDate",class:"form-select py-3","onUpdate:modelValue":o[8]||(o[8]=t=>s.reservationDate=t)},[(n(!0),l(f,null,g(x.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,kt))),128))],512),[[N,s.reservationDate]])]),e("div",null,[wt,v(e("select",{id:"form_reservationTime",class:"form-select py-3","onUpdate:modelValue":o[9]||(o[9]=t=>s.reservationTime=t)},[(n(!0),l(f,null,g(y.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,Nt))),128))],512),[[N,s.reservationTime]])]),e("div",null,[Dt,v(e("input",{type:"text",name:"name",id:"form_name",class:"form-input",placeholder:"name","onUpdate:modelValue":o[10]||(o[10]=t=>s.name=t),required:""},null,512),[[A,s.name,void 0,{trim:!0}]]),e("p",Tt,i(M(d).name),1)]),e("div",null,[Ct,v(e("input",{type:"tel",name:"phone",id:"form_tel",class:"form-input",placeholder:"0912345678","onUpdate:modelValue":o[11]||(o[11]=t=>s.phone=t),required:""},null,512),[[A,s.phone]]),e("p",St,i(M(d).phone),1)]),e("div",null,[Rt,v(e("select",{id:"form_status",class:"form-select py-3","onUpdate:modelValue":o[12]||(o[12]=t=>s.status=t)},[(n(!0),l(f,null,g(c.value,(t,a)=>(n(),l("option",{value:t,key:a},i(t),9,Lt))),128))],512),[[N,s.status]])]),e("div",Vt,[e("button",{type:"button",class:"w-full mr-1 btn btn-outline-dark",onClick:o[13]||(o[13]=W(t=>V(s.reservationId),["prevent"]))}," 取消預約 "),e("button",{type:"submit",class:"w-full ml-1 btn btn-dark",onClick:W(T,["prevent"])}," 確認修改 ",8,Ut)])])])):K("",!0)])])]),_:1},512)],64))}};export{Wt as default};
